{{#if (not isEditing)}}
  <div class="vl-u-display-flex vl-u-flex-align-baseline">
    <h3 class="vl-title vl-title--h3">
      {{t "subcase"}}
    </h3>
    {{#if (not (await subcase.isOC))}}
      {{#if isEditor}}
        <div class="vl-u-spacer-extended-left-s">
          <a class="vl-link" {{action "toggleIsEditing"}}>
            {{t "edit"}}
          </a>
        </div>
      {{/if}}
    {{/if}}
  </div>
  <div class="vl-u-spacer-extended-bottom">
    <p class="vl-u-text--capitalize">
      {{await subcase.subcaseName}}
    </p>
    <ul class="vlc-status-timeline">
      {{#each subcase.sortedPhases as |phase|}}
        {{#if (not (await subcase.isOC))}}
          <li
            class="vlc-status-timeline__item vlc-status-timeline__item--neutral"
          >
            <div class="vlc-status-timeline__dot"></div>
            {{#if (is-pending phase.code)}}
              <div class="skeletal-loader" role="alert" aria-busy="true"></div>
            {{else}}
              <div class="vlc-status-timeline__text">
                {{subcase-timeline-item-text
                  label=(await phase.code.label)
                  phase=phase
                  onAgendaInfo=(await subcase.onAgendaInfo)
                }}
              </div>
            {{/if}}
          </li>
        {{/if}}
      {{/each}}
    </ul>
  </div>
  <div class="vl-description-data">
    <div class="vl-grid vl-grid--is-stacked">
      <div class="vl-col--1-3 vl-col--1-2--xs">
        <span class="vl-description-data__label">
          {{t "number-session"}}
        </span>
        <span class="vl-description-data__value">
          {{#if (not (await subcase.isOC))}}
            {{t "no-number-yet"}}
          {{else}}
            {{await subcase.case.OCMeetingNumber}}
          {{/if}}
        </span>
      </div>
      {{#if (not (await subcase.isOC))}}
        <div class="vl-col--1-3 vl-col--1-2--xs">
          <span class="vl-description-data__label">
            {{t "requested-for-session"}}
          </span>
          <span class="vl-description-data__value">
            {{#if (await subcase.requestedForMeeting)}}
              {{t "requested-for-agenda"}}
              {{moment-format
                subcase.requestedForMeeting.plannedStart
                "DD MMMM YYYY"
              }}
            {{else}}
              {{t "not-yet-requested"}}
            {{/if}}
          </span>
        </div>
        <div class="vl-col--1-3 vl-col--1-2--xs">
          <span class="vl-description-data__label">
            {{t "is-on-agenda"}}
          </span>
          <span class="vl-description-data__value">
            {{#if (or
                      (is-pending subcase.isPostponed)
                      (is-pending subcase.onAgendaInfo)
                  )}}
                <div class="vl-loader"></div>
            {{else}}
              {{#if (await subcase.isPostponed)}}
                {{t "postponed-subcase"}}
              {{else}}
                {{#if (await subcase.onAgendaInfo)}}
                  {{#link-to
                          "agenda.agendaitems.agendaitem"
                          (await latestMeetingId)
                          (await latestAgendaItemId)
                          (query-params selectedAgenda=(await latestAgendaId))
                          class="vl-link"
                  }}
                    {{moment-format (await subcase.onAgendaInfo)  "DD MMMM YYYY"}}
                  {{/link-to}}
                {{else}}
                  {{t "not-yet-on-agenda"}}
                {{/if}}
              {{/if}}
            {{/if}}
          </span>
        </div>
      {{/if}}
      <div class="vl-col--1-3 vl-col--1-2--xs">
        <span class="vl-description-data__label">
          {{t "date-last-edited"}}
        </span>
        <span class="vl-description-data__value">
          {{moment-format subcase.modified "DD MMMM YYYY"}}
        </span>
      </div>
      {{#if (not (await subcase.isOC))}}
        <div class="vl-col--1-3 vl-col--1-2--xs">
          <span class="vl-description-data__label">
            {{t "decided-on"}}
          </span>
          <span class="vl-description-data__value">
            {{#if (is-pending subcase.decision.approved)}}
              <div class="skeletal-loader" role="alert" aria-busy="true"></div>
            {{else if (await subcase.decision.approved)}}
              {{moment-format (await subcase.decidedInfo) "DD.MM.YYYY"}}
            {{else}}
              {{t "not-yet-decided"}}
            {{/if}}
          </span>
        </div>
      {{/if}}
      <div class="vl-col--1-3 vl-col--1-2--xs">
        <span class="vl-description-data__label">
          {{t "requested-by"}}
        </span>
        {{#if (is-pending subcase.isOC)}}
          <div class="skeletal-loader" role="alert" aria-busy="true"></div>
        {{else if (await subcase.isOC)}}
          <span class="vl-description-data__value">
            {{await subcase.submitter.label}}
          </span>
        {{else}}
          <span class="vl-description-data__value">
            {{#if
              (or
                (is-pending subcase.requestedBy)
                (is-pending subcase.requestedBy.person)
              )
            }}
              <div class="skeletal-loader" role="alert" aria-busy="true"></div>
            {{else if subcase.requestedBy}}
              {{subcase.requestedBy.person.nameToDisplay}}
            {{else}}
              {{t "not-yet-requested"}}
            {{/if}}
          </span>
        {{/if}}
      </div>
    </div>
  </div>
{{else}}
  <div class="vlc-box">
    <div class="vl-u-spacer">
      <div class="vlc-input-field-block">
        {{web-components/vl-form-label value=(t "subcase-type")}}
        {{utils/model-selector
          modelName="case-type"
          searchField="label"
          sortField="label"
          propertyToShow="label"
          selectedItems=remarkType
          selectModel=(action "selectRemarkType")
        }}
      </div>
      <div class="vlc-input-field-block">
        {{web-components/vl-form-label value=(t "subcase-type-dropdown")}}
        {{utils/model-selector
          modelName="subcase-type"
          searchField="label"
          sortField="label"
          propertyToShow="label"
          selectedItems=type
          selectModel=(action "selectType")
        }}
      </div>
      <div class="vlc-input-field-block">
        {{web-components/vl-form-label value=(t "subcase-name")}}
        {{web-components/vl-form-input width="4" value=subcaseName}}
      </div>
    </div>
    <div class="vlc-toolbar vlc-toolbar--auto">
      <div class="vlc-toolbar__right">
        <a class="vl-link" {{action "cancelEditing"}}>
          {{t "cancel"}}
        </a>
      </div>
      <div class="vlc-toolbar__left">
        {{web-components/vl-save-button
          text=(t "save")
          isLoading=isLoading
          saveAction=(action "saveChanges")
        }}
      </div>
    </div>
  </div>
{{/if}}