{{!-- TODO: octane-refactor --}}
{{!-- template-lint-disable no-action --}}
<Auk::Panel>
  <Auk::Panel::Header>
    <Auk::Toolbar>
      <Auk::Toolbar::Group @position="left">
        <Auk::Toolbar::Item>
          <AuHeading @level="4" @skin="5" data-test-agendaitem-news-item-title>
            {{@newsletterInfo.title}}
          </AuHeading>
        </Auk::Toolbar::Item>
      </Auk::Toolbar::Group>
      <Auk::Toolbar::Group @position="right">
        <Auk::Toolbar::Item>
          {{#if (not (is-pending this.agendaitem.notaOrVisienota))}}
            {{#if (not (await this.agendaitem.notaOrVisienota))}}
              <Auk::Button
                data-test-newsletter-edit-item-no-nota
                @skin="borderless"
                @icon="document"
                @disabled={{true}}
                class="au-u-padding-right-none"
              >
                {{t "no-nota"}}
              </Auk::Button>
            {{else}}
              <Auk::Button
                data-test-newsletter-edit-item-nota
                @skin="borderless"
                @icon="document"
                class="au-u-padding-right-none"
                {{action "openDocument" this.agendaitem bubbles=false}}
              >
                {{t "open-note"}}
              </Auk::Button>
            {{/if}}
          {{else}}
            <div class="auk-loader" role="alert" aria-busy="true">
              <EmberTooltip @side="bottom" @tooltipClass="auk-tooltip">
                {{t "nota-loading-text"}}
              </EmberTooltip>
            </div>
          {{/if}}
        </Auk::Toolbar::Item>
      </Auk::Toolbar::Group>
    </Auk::Toolbar>
  </Auk::Panel::Header>
  <Auk::Panel::Body class="au-u-background-gray-100">
    <div class="auk-form-group">
      <Auk::Label>{{t "title"}}</Auk::Label>
      <p data-test-newsletter-edit-item-long-title>
        {{this.agendaitem.title}}
      </p>
    </div>
    <div class="auk-form-group">
      <Auk::Label>{{t "short-title"}}</Auk::Label>
      <Auk::Input
        data-test-newsletter-edit-item-short-title
        @block={{true}}
        @value={{this.newsletterInfo.title}}
      />
    </div>
    <div class="auk-form-group">
      <Auk::Label>{{t "mandatee-proposal"}}</Auk::Label>
      <p
        data-test-newsletter-edit-item-mandatee-proposal
      >
        {{#if (await this.newsletterInfo.newsletterProposal)}}
          {{await this.newsletterInfo.newsletterProposal}}
        {{else}}
          {{t "not-applicable"}}
        {{/if}}
      </p>
    </div>
    <div class="auk-form-group">
      <div class={{if (or this.isFullscreen @fullscreen) 'auk-rdfa-holder auk-rdfa-fullscreen' 'auk-rdfa-holder'}}>
        <div class="auk-rdfa-holder__header auk-o-flex auk-o-flex--justify-between auk-o-flex--vertical-center">
          <Auk::Label class="auk-u-p-0">
            {{t "decision-in-newsletter"}}
            <span class={{if (or this.isFullscreen @fullscreen) '' 'au-u-hidden-visually'}}>  voor {{@newsletterInfo.title}}</span>
          </Auk::Label>
          {{#if @fullscreen}}
          <AuButtonGroup>
            <Auk::Button @skin="borderless" @icon="minimize" {{action "closeFullscreen"}}>Sluit volledig scherm</Auk::Button>
            <WebComponents::VlSaveButton
              data-test-newsletter-edit-item-save={{true}}
              @text={{t "save"}}
              @isLoading={{this.isLoading}}
              @saveAction={{action "trySaveChanges"}}
            />
          </AuButtonGroup>
          {{else}}
            {{#if this.isFullscreen}}
            <AuButtonGroup>
              <Auk::Button @skin="borderless" @icon="minimize" {{action "fullscreen"}}>Sluit volledig scherm</Auk::Button>
              <WebComponents::VlSaveButton
                data-test-newsletter-edit-item-save={{true}}
                @text={{t "save"}}
                @isLoading={{this.isLoading}}
                @saveAction={{action "trySaveChanges"}}
              />
            </AuButtonGroup>
            {{else}}
            <Auk::Button @skin="borderless" @icon="expand" {{action "fullscreen"}}>Volledig scherm</Auk::Button>
            {{/if}}
          {{/if}}
        </div>
        <WebComponents::VlRdfaEditor
          data-test-newsletter-edit-item-rdfa-editor={{true}}
          @richtext={{await this.newsletterInfo.richtext}}
          @handleRdfaEditorInit={{action "handleRdfaEditorInit"}}
        />
      </div>
    </div>
  </Auk::Panel::Body>
  <Auk::Panel::Body class="au-u-background-gray-100">
    <div class="auk-form-group auk-u-text-capitalize">
      <Auk::Label>Opmerking</Auk::Label>
      <Auk::Input
        data-test-newsletter-edit-item-remark
        @block={{true}}
        @value={{this.newsletterInfo.remark}}
      />
    </div>
    <div class="auk-form-group">
      <Auk::Label for="item-finished">{{t "finished"}}</Auk::Label>
      <Auk::Toggle
        data-test-newsletter-edit-item-toggle-finished
        id="item-finished"
        @checked={{this.newsletterInfo.finished}}
      />
    </div>
    <div class="auk-form-group" data-test-newsletter-edit-item-themes-selector>
      <Auk::Label>{{t "themes"}}</Auk::Label>
      <Utils::ThemesSelector @selectedThemes={{await this.newsletterInfo.themes}} />
    </div>
  </Auk::Panel::Body>
  <Auk::Panel::Body class="au-u-background-gray-100">
    <Auk::Toolbar>
      <Auk::Toolbar::Group @position="right">
        <Auk::Toolbar::Item>
          <Auk::ButtonLink data-test-newsletter-edit-item-cancel {{action "cancelEditing"}}>
            {{t "cancel"}}
          </Auk::ButtonLink>
        </Auk::Toolbar::Item>
        <Auk::Toolbar::Item>
          <WebComponents::VlSaveButton
            data-test-newsletter-edit-item-save={{true}}
            @text={{t "save"}}
            @isLoading={{this.isLoading}}
            @saveAction={{action "trySaveChanges"}}
          />
        </Auk::Toolbar::Item>
      </Auk::Toolbar::Group>
    </Auk::Toolbar>
  </Auk::Panel::Body>
</Auk::Panel>

{{#if this.isTryingToSave}}
  <WebComponents::VlModalVerify
    @title={{t "no-themes-selected"}}
    @message={{t "no-themes-selected-message"}}
    @cancel={{action "cancelSaveChanges"}}
    @verify={{action "saveChanges"}}
    @buttonText="save"
    @buttonType="warning"
    @showIcon={{false}}
  />
{{/if}}