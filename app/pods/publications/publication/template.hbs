{{ page-title this.casePath }}
<WebComponents::AuNavbar @border="bottom" @skin="gray-100" @auto="true">
  <WebComponents::AuToolbar>
    <WebComponents::AuToolbar::Group @position="left">
      <WebComponents::AuToolbar::Item>
        <div class="auk-u-flex auk-u-flex--vertical auk-u-mt-2">
          <span class="auk-overline auk-u-muted"
                  data-test-publication-detail-menu-publication-number>
            {{uppercase
              this.casePath
            }}
          </span>
          <WebComponents::AuAbbreviatedText @text={{this.titleText}} @size="150" @custom="true" />
          <WebComponents::AuTabs @reversed="true">
            <WebComponents::AuTab @isHierarchicalBack="true" @route="publications" data-test-publication-case-nav-go-back></WebComponents::AuTab>
            <WebComponents::AuTab @route="publications.publication.case" data-test-publication-case-nav-case>{{t "agendaitem-case"}}</WebComponents::AuTab>
            <WebComponents::AuTab @route="publications.publication.documents" data-test-publication-case-nav-documents>
              <div class="auk-u-flex auk-u-flex--center">
                <span class="auk-u-mr-2">{{t "documents"}}</span>
                <p>{{this.documentsCount}}</p>
              </div>
            </WebComponents::AuTab>
            <WebComponents::AuTab @route="publications.publication.translations" data-test-publication-case-nav-translations>
              <div class="auk-u-flex auk-u-flex--center">
                <span class="auk-u-mr-2">{{t "translations"}}</span>
                <WebComponents::AuStatusPill @status={{this.showStatusForTranslations.status}}>{{this.showStatusForTranslations.value}}</WebComponents::AuStatusPill>
              </div>
            </WebComponents::AuTab>
            <WebComponents::AuTab @route="publications.publication.publishpreview" data-test-publication-case-nav-publishpreview>
              <div class="auk-u-flex auk-u-flex--center">
                <span class="auk-u-mr-2">{{t "publishpreview-requests"}}</span>
                <WebComponents::AuStatusPill @status={{this.showStatusForPublicationPreviews.status}}>{{this.showStatusForPublicationPreviews.value}}</WebComponents::AuStatusPill>
              </div>
            </WebComponents::AuTab>
          </WebComponents::AuTabs>
        </div>
      </WebComponents::AuToolbar::Item>
    </WebComponents::AuToolbar::Group>
  </WebComponents::AuToolbar>
</WebComponents::AuNavbar>

{{!-- Auk css gebruiken, component ? --}}
<div class="auk-panel-layout auk-panel-layout--responsive">
  <div class="auk-panel-layout__main-content auk-u-maximize-height auk-scroll-wrapper">
    <div class="auk-scroll-wrapper__body">
      <div class="auk-u-m-4">
        {{outlet}}
      </div>
    </div>
  </div>
  <div class="auk-panel-layout__sidebar">
    <WebComponents::AuSidebar @position="right"
                              class="auk-sidebar auk-sidebar--gray-100 auk-sidebar--right
                              auk-sidebar--large auk-sidebar--responsive {{if  this.collapsed 'auk-sidebar--collapsed'}}"
    >

      <WebComponents::AuNavbar @border="bottom" @skin="gray-100">
        <WebComponents::AuToolbar>
          <WebComponents::AuToolbar::Group @position="{{if  this.collapsed 'center' 'right'}}">
            <WebComponents::AuToolbar::Item>
              <WebComponents::AuButton @skin="borderless" @icon={{if this.collapsed "chevron-left" "chevron-right"}}
                                       @layout="icon-only" {{on 'click' this.toggleSidebar}} />
            </WebComponents::AuToolbar::Item>
          </WebComponents::AuToolbar::Group>
        </WebComponents::AuToolbar>
      </WebComponents::AuNavbar>
      {{#if (not collapsed)}}
        <div class="auk-scroll-wrapper">
          <div class="auk-scroll-wrapper__body">
            <div class="auk-u-m-3">
              <div class="auk-form-group {{getClassForPublicationNumber}}">
                <WebComponents::AuLabel>{{t 'publications-number'}}</WebComponents::AuLabel>
                <WebComponents::AuInput type="number" value={{this.model.publicationFlow.publicationNumber}}
                  {{on "input" (perform this.setPublicationNumber)}} />
                <WebComponents::AuInput size="5" type="text" value={{this.model.publicationFlow.publicationSuffix}}
                  {{on "input" (perform this.setPublicationSuffix)}} />

                {{#if this.numberIsAlreadyUsed}}
                  <div class="auk-form-help-text auk-form-help-text--danger">
                    <WebComponents::AuIcon @name="alert-triangle"/>
                    {{t "publication-number-already-taken"}}
                  </div>
                {{/if}}
                {{#if this.numberIsRequired}}
                  <div class="auk-form-help-text auk-form-help-text--danger">
                    <WebComponents::AuIcon @name="alert-triangle"/>
                    {{t "publication-number-required"}}
                  </div>
                {{/if}}
              </div>
              <div class="auk-form-group">
                <WebComponents::AuLabel for="blockInput">{{t 'status'}}</WebComponents::AuLabel>
                <WebComponents::AuPowerSelect @options={{this.statusOptions}}
                                              @isSearchable={{false}}
                                              @onchange={{this.setPublicationStatus}}
                                              @selected={{this.getPublicationStatus}}
                />
              </div>
              <div class="auk-form-group">
                <WebComponents::AuLabel for="blockInput">{{t "deduced-publication-type"}}</WebComponents::AuLabel>
                <Utils::RadioDropdownComboSelect @radioOptionsSize="3"
                                                 @options={{this.sortedDocumentTypes}}
                                                 @onSelect={{this.selectDocumentType}}
                                                 @selected={{this.getSelectedDocumentType}}
                />
              </div>
              <div class="auk-form-group">
                <WebComponents::AuLabel for="blockInput">{{t "kind-of-publication"}}</WebComponents::AuLabel>
                <WebComponents::AuPowerSelect @options={{this.typeOptions}}
                                              @isSearchable={{false}}
                                              @onchange={{this.setPublicationType}}
                                              @selected={{this.getPublicationType}}
                />
              </div>
              <div class="auk-form-group">
                {{web-components/vl-checkbox
                  value=(gt this.model.publicationFlow.priority 0)
                  label=(t "priority-procedure")
                  toggle=(action "togglePriorityProcedure")
                }}
              </div>
              <div class="auk-form-group">
                <WebComponents::AuLabel>{{t "publication-form-numac-nummer"}}</WebComponents::AuLabel>
                <div style="background: #FFFFFF;border: 1px solid #CCD1D9; box-sizing: border-box;  line-height: 0.8em;  padding: 7px;">
                  {{#if (gt this.numacNumbers.length 0) }}
                    {{#each this.numacNumbers as |numac|}}
                      <div class="vlc-numac-number-wrapper">
                        <div class="vlc-numac-number">
                          <span>{{ numac.name }}</span>
                        </div>
                        <div class="vlc-numac-number-delete-button-wrapper">
                          <WebComponents::AuButton class="auk-button--nopadding"
                            @skin="borderless"
                            @icon="close"
                            @layout="icon-only"
                            {{on "click" (fn this.deleteNumacNumber numac)}}
                            data-test-cases-backlink/>
                        </div>
                      </div>
                    {{/each}}
                  {{else}}
                    <span class="auk-icon--light">{{t "no-numac-number-yet"}}</span>
                  {{/if}}
                </div>
                <WebComponents::AuInput
                  type="text"
                  id="newNumacNumber"
                  value={{mut this.newNumacNumber}}
                  onchange={{action "setNumacNummer"}}
                />

                <WebComponents::AuButton
                  @skin="borderless"
                  {{on "click"
                   this.addNumacNumber}}>
                  {{t "add"}}
                </WebComponents::AuButton>
              </div>
              {{#if this.model.publicationFlow.status.isToBePublished}}
                <div class="auk-form-group">
                  <WebComponents::AuLabel>{{t 'publication-date-requested'}}</WebComponents::AuLabel>
                  {{#if this.showRequestedPublicationDatePicker}}
                    <WebComponents::AuDatepicker
                            @defaultDate={{this.getRequestedPublicationDate}}
                            @onChange={{this.setRequestedPublicationDate}}/>
                  {{else}}
                    <Utils::SimpleSpinner></Utils::SimpleSpinner>
                  {{/if}}
                </div>
                <div class="auk-form-group">
                  <WebComponents::AuLabel>{{t 'final-publication-date'}}</WebComponents::AuLabel>
                  {{#if this.showPublicationDatePicker}}
                    <WebComponents::AuDatepicker
                            @defaultDate={{this.getPublicationBeforeDate}}
                            @enabledDatesFunction={{action this.allowedPublicationDate}}
                            @onChange={{this.setPublicationBeforeDate}}/>
                  {{else}}
                    <Utils::SimpleSpinner></Utils::SimpleSpinner>
                  {{/if}}
                  {{#if this.expiredPublicationBeforeDate}}
                    <div class="auk-form-help-text auk-form-help-text--warning">
                      <WebComponents::AuIcon @name="alert-triangle"/>
                      {{t "date-expired"}}
                    </div>
                  {{/if}}
                  {{#if this.publicationNotAfterTranslationForPublication}}
                    <div class="auk-form-help-text auk-form-help-text--danger">
                      <WebComponents::AuIcon @name="alert-triangle"/>
                      {{t "publication-date-after-translation-date"}}
                    </div>
                  {{/if}}
                </div>
                <div class="auk-form-group">
                  <WebComponents::AuLabel>{{t 'final-translation-date'}}</WebComponents::AuLabel>
                  {{#if this.showTranslationDatePicker}}
                    <WebComponents::AuDatepicker
                            @defaultDate={{this.getTranslationDate}}
                            @enabledDatesFunction={{action this.allowedTranslationDate}}
                            @onChange={{this.setTranslationDate}}/>
                  {{else}}
                    <Utils::SimpleSpinner></Utils::SimpleSpinner>
                  {{/if}}
                  {{#if this.expiredTranslationDate}}
                    <div class="auk-form-help-text auk-form-help-text--warning">
                      <WebComponents::AuIcon @name="alert-triangle"/>
                      {{t "date-expired"}}
                    </div>
                  {{/if}}
                  {{#if this.publicationNotAfterTranslationForTranslation}}
                    <div class="auk-form-help-text auk-form-help-text--danger">
                      <WebComponents::AuIcon @name="alert-triangle"/>
                      {{t "publication-date-after-translation-date"}}
                    </div>
                  {{/if}}
                </div>
              {{/if}}
              {{#if this.model.publicationFlow.status.isPublished}}
                <div class="auk-form-group">
                  <WebComponents::AuLabel for="blockInput">{{t "publication-form-publication-date"}}</WebComponents::AuLabel>
                  <WebComponents::AuDatepicker @defaultDate={{this.getPublicationDate}} @onChange={{this.setPublicationDate}}/>
                  {{#if this.expiredPublicationDate}}
                    <div class="auk-form-help-text auk-form-help-text--warning">
                      <WebComponents::AuIcon @name="alert-triangle"/>
                      {{t "date-expired"}}
                    </div>
                  {{/if}}
                </div>
              {{/if}}
              <div class="auk-form-group">
                <WebComponents::AuLabel>
                  <div class="auk-u-flex auk-u-flex--vertical-center">
                    <span class="auk-u-mr">{{t "remark-title"}}</span>
                    <div>
                      <WebComponents::AuButtonLink @icon="circle-info" @layout="icon-right" @skin="muted"/>
                      <EmberTooltip @tooltipClass="auk-tooltip" @side="bottom">
                        <p>
                          {{t "publication-sidebar-tooltip"}}
                        </p>
                      </EmberTooltip>
                    </div>
                  </div>
                </WebComponents::AuLabel>
                <WebComponents::AuTextarea rows="4" type="text" value={{this.getRemark}} {{on "input" (perform this.setRemark)}}></WebComponents::AuTextarea>
              </div>
            </div>
          </div>
        </div>
      {{/if}}
    </WebComponents::AuSidebar>
  </div>
</div>

{{#if this.showConfirmWithdraw}}
  <WebComponents::AuModal @size="small">
    <WebComponents::AuModal::Header
            @title={{t "discharge-publication"}}
            @hideCloseButton={{true}}
    />
    <WebComponents::AuModal::Body>
      {{t "discharge-publication-flow-confirm"}}
    </WebComponents::AuModal::Body>
    <WebComponents::AuModal::Footer @custom={{true}}>
      <WebComponents::AuToolbar>
        <WebComponents::AuToolbar::Group @position="left"n>
          <WebComponents::AuToolbar::Item>
            <WebComponents::AuButton @skin="borderless" {{on "click" this.cancelWithdraw}}>
              {{t "cancel"}}
            </WebComponents::AuButton>
          </WebComponents::AuToolbar::Item>
        </WebComponents::AuToolbar::Group>
        <WebComponents::AuToolbar::Group @position="right">
          <WebComponents::AuToolbar::Item>
            <WebComponents::AuButton @skin="danger-primary" {{on "click" this.withdrawPublicationFlow}}>
              {{t "discharge"}}
            </WebComponents::AuButton>
          </WebComponents::AuToolbar::Item>
        </WebComponents::AuToolbar::Group>
      </WebComponents::AuToolbar>
    </WebComponents::AuModal::Footer>
  </WebComponents::AuModal>
{{/if}}



{{#if this.showLoader}}
  <WebComponents::AuLoadingOverlay/>
{{/if}}