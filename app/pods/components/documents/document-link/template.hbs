<div class="vl-u-spacer-extended-bottom-s {{if @documentContainer.aboutToDelete "vlc-document--deleted-state" }}">
  <div class="vlc-document-card">
    <div class="vlc-document-card__summary">
      <div class="vlc-document-card__content">
        <div class="vlc-toolbar vlc-toolbar--auto">
          <div class="vlc-toolbar__left">
            <div class="vlc-toolbar__item">
              <p class="vlc-subline vlc-document-card__subline">
                {{@documentContainer.type.label}}
              </p>
            </div>
          </div>
          <div class="vlc-toolbar__right">
            <div class="vlc-toolbar__item vl-u-display-flex">
              {{#if this.lastPiece}}
                <AccessLevelPill @lastPiece={{this.lastPiece}} />
              {{/if}}
            </div>
            <div class="vlc-toolbar__item">
              {{#if this.currentSession.isEditor}}
                <button
                  class="vl-button vl-button--link vl-button--icon"
                  data-test-documents-show-more
                  type="button"
                >
                  <i class="ki-more"></i>
                  <AttachPopover
                    @renderInPlace={{true}}
                    @class="ember-attacher-popper"
                    @hideOn="clickout click"
                    @showOn="click"
                    @animation="shift"
                    @placement="bottom"
                    as |attacher|
                  >
                    <ul class="vlc-dropdown-menu">
                      <li class="vlc-dropdown-menu__item">
                        <button class="vl-link vl-link--block" type="button"
                          data-test-document-upload-new-piece
                          {{on "click" attacher.hide}}
                          {{on "click" (fn this.openUploadModal)}}
                        >
                          {{t "new-version"}}
                        </button>
                      </li>
                      <li class="vlc-dropdown-menu__item">
                        <button class="vl-link vl-link--block" type="button"
                          {{on "click" attacher.hide}}
                          {{on "click" this.enableEditPieceName}}
                        >
                          {{t "document-title-edit"}}
                        </button>
                      </li>
                      <li class="vlc-dropdown-menu__separator" aria-hidden="true"></li>
                      <li class="vlc-dropdown-menu__item vlc-dropdown-menu__item--action-danger">
                        <button class="vl-link vl-link--block vl-u-text--error" type="button"
                          {{on "click" attacher.hide}}
                          {{on "click" this.deleteDocumentContainer}}
                        >
                          {{t "document-delete"}}
                        </button>
                      </li>
                    </ul>
                  </AttachPopover>
                </button>
              {{/if}}
            </div>
          </div>
        </div>
        <div class="vl-u-display-flex">
          <div class="vlc-document-card__badge
            {{if
              @documentContainer.checkAdded
              "vlc-document-list__item vlc-document-list__item--active"
            }}"
          >
            <div class="vl-badge vl-badge--icon vl-badge--icon-light vl-badge--alt vl-badge--small-medium vl-icon-wrapper">
              <i class="vl-badge__icon ki-document" aria-hidden="true"></i>
            </div>
          </div>
          <div class="vl-u-display-flex vlc-u-flex-direction-column vlc-u-box-model-maximize-width">
            {{#if this.isEditingPiece}}
              <div class="vl-u-display-flex vlc-u-display-flex-align-center">
                {{input
                  type="text"
                  class="vl-input-field vl-input-field--block"
                  value=this.pieceNameBuffer
                }}
                <button
                  class="vl-button vl-button--link vl-button--icon"
                  type="button"
                  {{on "click" (perform this.savePieceName)}}
                >
                  <i
                    class="ki-check vl-button__icon"
                    aria-hidden="true"
                  ></i>
                  <span class="vl-u-visually-hidden">
                    {{t "more-options"}}
                  </span>
                </button>
                <button
                  class="vl-button vl-button--link vl-button--icon"
                  type="button"
                  {{on "click" this.cancelEditPieceName}}
                >
                  <i
                    class="ki-cross vl-button__icon"
                    aria-hidden="true"
                  ></i>
                  <span class="vl-u-visually-hidden">
                    {{t "more-options"}}
                  </span>
                </button>
              </div>
            {{else}}
              <h6 class="vl-title vl-title--h6">
                <span {{on "click" this.enableEditPieceName}}>
                  {{this.lastPiece.name}}
                </span>
              </h6>
            {{/if}}
            <div class="vlc-document-card-content__meta">
              {{t "uploaded-at"}}
              {{moment-format this.lastPiece.created}}
              {{t "at"}}
              {{moment-format this.lastPiece.created "HH:mm"}}
              {{#if this.lastPiece.accessLevelLastModified}}
                <div>
                  {{t "access-level-last-modified"}}
                  {{moment-format this.lastPiece.accessLevelLastModified}}
                  {{t "at"}}
                  {{moment-format this.lastPiece.accessLevelLastModified "HH:mm"}}
                </div>
              {{/if}}
            </div>
          </div>
        </div>
      </div>
    </div>
    {{#if this.reverseSortedPieces.length}}
      <div class="vlc-document-card__more">
        <div class="js-vl-accordion {{if this.isExpandedVersionHistory "js-vl-accordion--open"}}">
          <button
            class="vl-toggle vl-link vl-link--bold"
            type="button"
            {{on "click" this.toggleVersionHistory}}
          >
            <i class="vl-link__icon vl-link__icon--before vl-toggle__icon ki-chevron-right"
            ></i>
            {{t "show-pieces"}}
          </button>
          {{#if this.isExpandedVersionHistory}}
            <div class="vl-accordion__content js-vl-accordion__content">
              <div class="vl-accordion__panel">
                {{#each this.reverseSortedPieces as |piece|}}
                  <WebComponents::VlDocument
                    @piece={{piece}} />
                {{/each}}
              </div>
            </div>
          {{/if}}
        </div>
      </div>
    {{/if}}
  </div>
</div>

{{#if this.isOpenUploadModal}}
  <WebComponents::VlModal
    @closeModal={{perform this.cancelUploadPiece}}
    @isOverlay={{true}}
    @title={{t "new-document-piece"}}>
    <div class="vl-modal-dialog__content">
      {{#if this.newPiece}}
        <WebComponents::VlFormLabel @value={{t "name"}} />
        <WebComponents::VlFormInput
          @value={{this.newPiece.name}}
          @width={{4}} />
        <Documents::DocumentUpload
          @piece={{this.newPiece}}
          @onDelete={{perform this.deleteUploadedPiece}} />
      {{else}}
        <FileUploader @multipleFiles={{false}} @uploadedFileAction={{perform this.uploadPiece}}/>
      {{/if}}
    </div>
    <WebComponents::VlModalFooter
      @cancelButtonText={{t "cancel"}}
      @saveButtonText={{t "add"}}
      @isLoading={{this.addPiece.isRunning}}
      @cancelAction={{perform this.cancelUploadPiece}}
      @saveAction={{perform this.addPiece}}
      @disableSave={{not this.newPiece}} />
  </WebComponents::VlModal>
{{/if}}
{{#if this.isOpenVerifyDeleteModal}}
  <WebComponents::VlModalVerify
    @title={{t "document-delete"}}
    @message={{t "delete-document-message"}}
    @cancel={{this.cancelDeleteDocumentContainer}}
    @verify={{this.verifyDeleteDocumentContainer}} />
{{/if}}
