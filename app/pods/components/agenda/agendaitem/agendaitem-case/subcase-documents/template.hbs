<div class="vl-u-spacer--large">
  <div class="vl-u-spacer">
    <div class="vl-u-display-flex vlc-u-display-flex-align-center">
      <h4 class="vl-title vl-title--h4">
        {{t "documents"}}
      </h4>
      {{#if 
        (and currentSession.isEditor (gt (await @agendaitemOrSubcaseOrMeeting.documentContainersLength) 0))
      }}
        <div class="vl-u-spacer-extended-left-s">
          <a data-test-subcase-documents-edit href="" class="vl-link" {{action this.toggleIsEditing}}>
            {{t "edit"}}
          </a>
        </div>
      {{/if}}
    </div>
  </div>
  {{#if (not this.isEditing)}}
    {{#if (is-pending @agendaitemOrSubcaseOrMeeting.documentContainers)}}
      <WebComponents::VlLoader @text={{t "documents-loading-text"}} />
    {{else if (not governmentCanViewDocuments)}}
      <div class="vl-u-spacer-extended-top-s">
        <WebComponents::VlAlert @message={{t "no-documents-yet"}} />
      </div>
    {{!-- template-lint-disable block-indentation --}}
    {{else if 
      (gt (await @agendaitemOrSubcaseOrMeeting.documentContainersLength) 0)
    }}
      {{#each 
        (await @agendaitemOrSubcaseOrMeeting.documentContainers) 
      as |documentContainer|
      }}
        <Agenda::Agendaitem::AgendaitemCase::SubcaseDocument::DocumentLink
              @documentContainer={{documentContainer}}
              @subcaseAgendaitemMeetingOrDocumentContainer={{@agendaitemOrSubcaseOrMeeting}} />
      {{/each}}
    {{else}}
      <div class="vl-u-spacer-extended-top-s">
        <WebComponents::VlAlert @message={{t "no-documents-yet"}} />
      </div>
    {{/if}}
  {{else}}
    <Agenda::Agendaitem::AgendaitemCase::EditSubcaseDocuments
            @documentContainers={{await @agendaitemOrSubcaseOrMeeting.documentContainers}}
            @agendaitemOrSubcaseOrMeeting={{@agendaitemOrSubcaseOrMeeting}}
            @cancelForm={{action this.cancelEditing}} />
  {{/if}}
  {{#if (is-pending @agendaitemOrSubcaseOrMeeting.documentContainers)}}
    <button type="button" class="vl-button vl-button--loading" disabled>
      {{t "please-be-patient"}}
    </button>
  {{else if currentSession.isEditor}}
    <div class="vl-u-spacer">
      <button type="button" class="vl-button vl-button--tertiary vl-button--icon-before"
        {{action "toggleisAddingNewDocumentContainer"}}>
        <i class="vl-button__icon vl-button__icon--before ki-add"></i>
        {{t "documents-add"}}
      </button>
    </div>
  {{/if}}
  {{#if this.shouldShowLinkedPieces}}
    <div class="vl-u-spacer">
      <div class="vl-u-display-flex vlc-u-display-flex-align-center">
        <h4 class="vl-title vl-title--h4">
          {{t "linked-documents"}}
        </h4>
      </div>
    </div>
    {{#if (is-pending @agendaitemOrSubcaseOrMeeting.linkedDocumentContainers)}}
      <WebComponents::VlLoader @text={{t "documents-loading-text"}} />
    {{else if 
      (gt (await @agendaitemOrSubcaseOrMeeting.linkedDocumentContainersLength) 0)
    }}
      {{#each 
        (await @agendaitemOrSubcaseOrMeeting.linkedDocumentContainers) 
      as |documentContainer|
      }}
        <Agenda::Agendaitem::AgendaitemCase::SubcaseDocument::LinkedDocumentLink
                @documentContainer={{documentContainer}}
                @agendaitemOrSubcaseOrMeeting={{@agendaitemOrSubcaseOrMeeting}} />
      {{/each}}
    {{else}}
      <div class="vl-u-spacer-extended-top-s">
        <WebComponents::VlAlert @message={{t "no-linked-documents-yet"}} />
      </div>
    {{/if}}
    {{#if (is-pending @agendaitemOrSubcaseOrMeeting.linkedDocumentContainers)}}
      <button type="button" class="vl-button vl-button--loading" disabled>
        {{t "please-be-patient"}}
      </button>
    {{else if currentSession.isEditor}}
      <div class="vl-u-spacer">
        <button type="button" class="vl-button vl-button--tertiary vl-button--icon-before"
                data-test-add-linked-documents
          {{on "click" this.toggleisLinkingOldPiece}}>
          <i class="vl-button__icon vl-button__icon--before ki-add"
          ></i>
          {{t "document-link-old"}}
        </button>
      </div>
    {{/if}}
  {{/if}}
</div>
{{#if this.isAddingNewDocumentContainer}}
  <WebComponents::VlModal
          @closeModal={{action this.deleteAllPiecesInCreation}}
          @isOverlay={{true}}
          @large={{true}}
          @title={{t "documents-add"}} >
    <div class="vl-modal-dialog__content">
      {{#if showDetail}}
        <div class="vl-u-align-right vl-u-spacer-extended-s">
          <LinkTo
                  @route="cases.case.subcases.subcase.overview"
                  @model={{agendaitemOrSubcaseOrMeeting.id}}
                  @target="_blank">
            {{t "to-subcase"}}
          </LinkTo>
        </div>
      {{/if}}
      {{file-uploader
        isLoading=this.isLoading
        multipleFiles=true
        uploadedFileAction=(action this.add)
      }}
      {{#if (not this.isLoading)}}
        <div class="upload-container">
          {{#each this.piecesInCreation as |piece|}}
            {{#ember-kaleidos-webuniversum/vl-uploaded-document
              name=piece.file.filename
              extension=piece.file.extension
              size=piece.file.size
              downloadName=piece.file.filename
              downloadLink=(concat
                      piece.file.downloadLink
                      "?name="
                      piece.file.filename
              )
              delete=(fn this.delete piece)
            }}
              <div class="metadata-container">
                <div class="vlc-input-field-block">
                  <WebComponents::VlFormLabel @value={{t "document-name"}} />
                  <WebComponents::VlFormInput
                          @width="4"
                          @value={{mut piece.name}} />
                </div>
                <div class="vlc-input-field-block">
                  <WebComponents::VlFormLabel @value={{t "document-type"}} />
                  {{#if
                    (and
                            (is-fulfilled piece.documentContainer.type)
                            this.documentTypes)
                  }}
                    <Utils::RadioDropdownComboSelect
                      @options={{this.documentTypes}}
                      @onSelect={{fn this.chooseDocumentContainerType piece}}
                      @selected={{get
                        piece.documentContainer.type
                        "content"
                      }} {{!-- content getter and if-fulfilled condition because of computeds retruning promise-proxies --}}
                    />
                  {{/if}}
                </div>
              </div>
            {{/ember-kaleidos-webuniversum/vl-uploaded-document}}
          {{/each}}
        </div>
      {{else}}
        <WebComponents::VlLoader @text={{t "documents-loading-text"}} />
      {{/if}}
    </div>
    <WebComponents::VlModalFooter
      @isLoading={{this.isLoading}}
      @cancelButtonText={{t "cancel"}}
      @saveButtonText={{t "documents-add"}}
      @cancelAction={{action this.deleteAllPiecesInCreation}}
      @saveAction={{action this.saveDocumentContainers}}
      @disableSave={{eq this.piecesInCreation.length 0}} />
  </WebComponents::VlModal>
{{/if}}
{{#if this.isLinkingOldPiece}}
  <WebComponents::VlModal
    @closeModal={{action this.toggleisLinkingOldPiece}}
    @isOverlay={{true}}
    @large={{true}}
    @title={{t "document-link-old"}} >
    <div class="vl-modal-dialog__content">
      <Utils::AddExistingPiece
        @add={{action this.link}}
        @delete={{action this.unlink}} />
    </div>
    <WebComponents::VlModalFooter
      @isLoading={{this.isLoading}}
      @cancelButtonText={{t "cancel"}}
      @saveButtonText={{t "document-link-old"}}
      @cancelAction={{action this.toggleisLinkingOldPiece}}
      @saveAction={{action this.linkPieces}}
      @disableSave={{eq piecesToLink.length 0}} />
  </WebComponents::VlModal>
{{/if}}